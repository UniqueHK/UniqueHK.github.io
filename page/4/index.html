<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>宽视角</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="年轻是什么？就是越挫越勇！">
<meta property="og:type" content="website">
<meta property="og:title" content="宽视角">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="宽视角">
<meta property="og:description" content="年轻是什么？就是越挫越勇！">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="宽视角">
<meta name="twitter:description" content="年轻是什么？就是越挫越勇！">
  
    <link rel="alternative" href="/atom.xml" title="宽视角" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	
		<form class="search" action="/search/index.html" method="get" accept-charset="utf-8">
			<label>Search</label>
			<input type="text" id="st-search-input" class="st-default-search-input st-search-input_my" maxlength="30" placeholder="Search" />
		</form>
	
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="https://avatars1.githubusercontent.com/u/4168558?v=3&amp;s=460" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">宽视角</a></h1>
		</hgroup>

		
        <h3 style="font-weight:bold;font-style:italic;" class="header-subtitle">listen</h3>
        

		
		<p class="header-subtitle">年轻是什么？就是越挫越勇！</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						<li>Links</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/listen-lavender" title="github">github</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/" style="font-size: 10px;">==</a> <a href="/tags/DAG/" style="font-size: 10px;">DAG</a> <a href="/tags/FP/" style="font-size: 10px;">FP</a> <a href="/tags/LRU-cache/" style="font-size: 10px;">LRU cache</a> <a href="/tags/Newton-iteration/" style="font-size: 10px;">Newton iteration</a> <a href="/tags/OOP/" style="font-size: 10px;">OOP</a> <a href="/tags/Slice分布式/" style="font-size: 10px;">Slice分布式</a> <a href="/tags/Time-Quantum/" style="font-size: 10px;">Time Quantum</a> <a href="/tags/async-task/" style="font-size: 10px;">async task</a> <a href="/tags/asynchronous/" style="font-size: 10px;">asynchronous</a> <a href="/tags/asyncio/" style="font-size: 10px;">asyncio</a> <a href="/tags/authority/" style="font-size: 10px;">authority</a> <a href="/tags/background/" style="font-size: 10px;">background</a> <a href="/tags/beanstalkd/" style="font-size: 10px;">beanstalkd</a> <a href="/tags/binary-search/" style="font-size: 10px;">binary search</a> <a href="/tags/bit/" style="font-size: 10px;">bit</a> <a href="/tags/bitmap/" style="font-size: 20px;">bitmap</a> <a href="/tags/brpop/" style="font-size: 10px;">brpop</a> <a href="/tags/cache-algorithm/" style="font-size: 10px;">cache algorithm</a> <a href="/tags/cell/" style="font-size: 10px;">cell</a> <a href="/tags/column/" style="font-size: 10px;">column</a> <a href="/tags/comet-streaming/" style="font-size: 10px;">comet streaming</a> <a href="/tags/complicated/" style="font-size: 10px;">complicated</a> <a href="/tags/concurrently/" style="font-size: 10px;">concurrently</a> <a href="/tags/context/" style="font-size: 10px;">context</a> <a href="/tags/coroutine/" style="font-size: 10px;">coroutine</a> <a href="/tags/csrf/" style="font-size: 10px;">csrf</a> <a href="/tags/dag/" style="font-size: 10px;">dag</a> <a href="/tags/data-pipeline/" style="font-size: 10px;">data pipeline</a> <a href="/tags/datamodel/" style="font-size: 10px;">datamodel</a> <a href="/tags/distributed/" style="font-size: 10px;">distributed</a> <a href="/tags/dynamic/" style="font-size: 10px;">dynamic</a> <a href="/tags/extract/" style="font-size: 10px;">extract</a> <a href="/tags/flexible/" style="font-size: 10px;">flexible</a> <a href="/tags/frame/" style="font-size: 10px;">frame</a> <a href="/tags/gen-coroutine/" style="font-size: 10px;">gen.coroutine</a> <a href="/tags/goroutine/" style="font-size: 10px;">goroutine</a> <a href="/tags/greenlet/" style="font-size: 10px;">greenlet</a> <a href="/tags/gunicorn/" style="font-size: 10px;">gunicorn</a> <a href="/tags/hashtable/" style="font-size: 10px;">hashtable</a> <a href="/tags/hash优化/" style="font-size: 10px;">hash优化</a> <a href="/tags/hash制度/" style="font-size: 10px;">hash制度</a> <a href="/tags/header/" style="font-size: 10px;">header</a> <a href="/tags/http1-0/" style="font-size: 10px;">http1.0</a> <a href="/tags/http1-1/" style="font-size: 10px;">http1.1</a> <a href="/tags/http2-0/" style="font-size: 10px;">http2.0</a> <a href="/tags/include/" style="font-size: 10px;">include</a> <a href="/tags/index/" style="font-size: 20px;">index</a> <a href="/tags/interface/" style="font-size: 10px;">interface</a> <a href="/tags/ioloop/" style="font-size: 10px;">ioloop</a> <a href="/tags/is/" style="font-size: 10px;">is</a> <a href="/tags/json/" style="font-size: 10px;">json</a> <a href="/tags/judge/" style="font-size: 10px;">judge</a> <a href="/tags/keyexpired/" style="font-size: 10px;">keyexpired</a> <a href="/tags/learning/" style="font-size: 10px;">learning</a> <a href="/tags/level/" style="font-size: 20px;">level</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/long-polling/" style="font-size: 10px;">long polling</a> <a href="/tags/lpush/" style="font-size: 10px;">lpush</a> <a href="/tags/lxml/" style="font-size: 10px;">lxml</a> <a href="/tags/mergelist/" style="font-size: 10px;">mergelist</a> <a href="/tags/method/" style="font-size: 10px;">method</a> <a href="/tags/mongo/" style="font-size: 10px;">mongo</a> <a href="/tags/mongo-id/" style="font-size: 10px;">mongo_id</a> <a href="/tags/monitor/" style="font-size: 10px;">monitor</a> <a href="/tags/mq通信/" style="font-size: 10px;">mq通信</a> <a href="/tags/multi-process/" style="font-size: 10px;">multi process</a> <a href="/tags/nosql/" style="font-size: 10px;">nosql</a> <a href="/tags/object-oriented/" style="font-size: 10px;">object-oriented</a> <a href="/tags/off-schedule/" style="font-size: 10px;">off-schedule</a> <a href="/tags/package/" style="font-size: 10px;">package</a> <a href="/tags/parallel/" style="font-size: 10px;">parallel</a> <a href="/tags/parametrized/" style="font-size: 10px;">parametrized</a> <a href="/tags/performance/" style="font-size: 10px;">performance</a> <a href="/tags/phantomjs/" style="font-size: 10px;">phantomjs</a> <a href="/tags/pointer/" style="font-size: 10px;">pointer</a> <a href="/tags/pointerarray/" style="font-size: 10px;">pointerarray</a> <a href="/tags/powerful/" style="font-size: 10px;">powerful</a> <a href="/tags/priority/" style="font-size: 20px;">priority</a> <a href="/tags/procedure-oriented/" style="font-size: 10px;">procedure-oriented</a> <a href="/tags/property/" style="font-size: 10px;">property</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/queue/" style="font-size: 10px;">queue</a> <a href="/tags/recursive-struct/" style="font-size: 10px;">recursive struct</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/regex/" style="font-size: 10px;">regex</a> <a href="/tags/requests/" style="font-size: 10px;">requests</a> <a href="/tags/row/" style="font-size: 10px;">row</a> <a href="/tags/rpc通信/" style="font-size: 10px;">rpc通信</a> <a href="/tags/rwx/" style="font-size: 10px;">rwx</a> <a href="/tags/setter-getter/" style="font-size: 10px;">setter/getter</a> <a href="/tags/shell-script/" style="font-size: 10px;">shell script</a> <a href="/tags/signatures/" style="font-size: 10px;">signatures</a> <a href="/tags/specific-type/" style="font-size: 10px;">specific type</a> <a href="/tags/sqrt/" style="font-size: 10px;">sqrt</a> <a href="/tags/task/" style="font-size: 10px;">task</a> <a href="/tags/task-flow/" style="font-size: 10px;">task flow</a> <a href="/tags/threading/" style="font-size: 10px;">threading</a> <a href="/tags/type-assert/" style="font-size: 10px;">type assert</a> <a href="/tags/urlparameter/" style="font-size: 10px;">urlparameter</a> <a href="/tags/websocket/" style="font-size: 10px;">websocket</a> <a href="/tags/weight/" style="font-size: 10px;">weight</a> <a href="/tags/workflow/" style="font-size: 10px;">workflow</a> <a href="/tags/worthy/" style="font-size: 10px;">worthy</a> <a href="/tags/上/" style="font-size: 10px;">上</a> <a href="/tags/两小无猜/" style="font-size: 10px;">两小无猜</a> <a href="/tags/乌托邦/" style="font-size: 10px;">乌托邦</a> <a href="/tags/人生半坡/" style="font-size: 10px;">人生半坡</a> <a href="/tags/优先级/" style="font-size: 10px;">优先级</a> <a href="/tags/使用场景/" style="font-size: 10px;">使用场景</a> <a href="/tags/先验概率/" style="font-size: 10px;">先验概率</a> <a href="/tags/全概率/" style="font-size: 10px;">全概率</a> <a href="/tags/冲突/" style="font-size: 10px;">冲突</a> <a href="/tags/减法/" style="font-size: 10px;">减法</a> <a href="/tags/分布式/" style="font-size: 10px;">分布式</a> <a href="/tags/分支限界/" style="font-size: 10px;">分支限界</a> <a href="/tags/分治/" style="font-size: 10px;">分治</a> <a href="/tags/分类/" style="font-size: 10px;">分类</a> <a href="/tags/动态规划/" style="font-size: 10px;">动态规划</a> <a href="/tags/努力/" style="font-size: 10px;">努力</a> <a href="/tags/匿名变量/" style="font-size: 10px;">匿名变量</a> <a href="/tags/单线程/" style="font-size: 10px;">单线程</a> <a href="/tags/后验概率/" style="font-size: 10px;">后验概率</a> <a href="/tags/周星驰/" style="font-size: 10px;">周星驰</a> <a href="/tags/哈希/" style="font-size: 10px;">哈希</a> <a href="/tags/回溯/" style="font-size: 10px;">回溯</a> <a href="/tags/多线程/" style="font-size: 10px;">多线程</a> <a href="/tags/富类hash/" style="font-size: 10px;">富类hash</a> <a href="/tags/小巧/" style="font-size: 10px;">小巧</a> <a href="/tags/嵌入式脚本/" style="font-size: 10px;">嵌入式脚本</a> <a href="/tags/异步IO/" style="font-size: 10px;">异步IO</a> <a href="/tags/张小凡/" style="font-size: 10px;">张小凡</a> <a href="/tags/性能/" style="font-size: 10px;">性能</a> <a href="/tags/排序/" style="font-size: 10px;">排序</a> <a href="/tags/新年快乐/" style="font-size: 10px;">新年快乐</a> <a href="/tags/条件查询/" style="font-size: 10px;">条件查询</a> <a href="/tags/条件概率/" style="font-size: 10px;">条件概率</a> <a href="/tags/浮夸/" style="font-size: 10px;">浮夸</a> <a href="/tags/混沌hash/" style="font-size: 10px;">混沌hash</a> <a href="/tags/热加载/" style="font-size: 10px;">热加载</a> <a href="/tags/父类方法调用子类方法/" style="font-size: 10px;">父类方法调用子类方法</a> <a href="/tags/状态/" style="font-size: 10px;">状态</a> <a href="/tags/田灵儿/" style="font-size: 10px;">田灵儿</a> <a href="/tags/自省自乐/" style="font-size: 10px;">自省自乐</a> <a href="/tags/自虐/" style="font-size: 10px;">自虐</a> <a href="/tags/贪心/" style="font-size: 10px;">贪心</a> <a href="/tags/转码/" style="font-size: 10px;">转码</a> <a href="/tags/阻塞完成/" style="font-size: 10px;">阻塞完成</a> <a href="/tags/随心随性/" style="font-size: 10px;">随心随性</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://braavos.me/">落在深海</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://sanyuesha.com/">三月沙</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">listen</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="https://avatars1.githubusercontent.com/u/4168558?v=3&amp;s=460" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">listen</h1>
			</hgroup>
			
			<p class="header-subtitle">年轻是什么？就是越挫越勇！</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/listen-lavender" title="github">github</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-queue1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/02/queue1/" class="article-date">
  	<time datetime="2016-08-02T09:36:04.000Z" itemprop="datePublished">2016-08-02</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/02/queue1/">优先级队列 --- 等级队列 vs 权重队列</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>队列是一种安排数据辅助程序处理的工具，常见的有fifo队列，lifo队列和priority队列。</p>
<p>priority队列里面根据容器实现的局限，可以分为权重队列和等级队列，其中权重队列&gt;=等级队列。权重队列是指每一条入队列的数据的priority都有可能不同，并且priority很随机，不同的情况很多；等级队列是指所有的数据的priority可以分为有限的几类，每一类对应一个数据channel，逻辑层面个人觉得最好是不超过5吧，具体情况还得看工具支持的情况。实际上等级队列更像数据的priority分类取，权重队列则是数据的priority排序取。</p>
<h2 id="权重队列"><a href="#权重队列" class="headerlink" title="权重队列"></a>权重队列</h2><p>权重队列的priority基本不受约束，使用起来比较自由，只要容器支持数据的排序和数据同步，就能基于该容器实现权重队列。<br>例如：</p>
<blockquote>
<ul>
<li>大顶堆和小顶堆支持堆排序，然后通过锁实现数据同步，因此程序语言实现的标准队列的priority队列都是权重队列</li>
<li>mongo是数据库，支持字段排序，并且有find_and_modify可以实现数据同步，也可以实现权重队列。</li>
<li>beanstalkd的内部协议支持排序，所以是权重队列。</li>
</ul>
</blockquote>
<h2 id="等级队列"><a href="#等级队列" class="headerlink" title="等级队列"></a>等级队列</h2><p>等级队列的priority在程序员编码的时候就固定了，是像常量一样执行前设定的，数的清的，不能动态添加设定之外priority数据，一般实现等级队列的容器需要支持数据channel，当然必须是数据同步。<br>例如：</p>
<blockquote>
<ul>
<li>redis的list可以作为数据channel使用，然后通过blpop、brpop实现数据同步，如果sorted set不支持数据同步，就可以实现权重队列。</li>
<li>rabbitmq，多么强大的队列，是通过数据channel实现等级队列，3.5.0版本以后有rabbitmq_priority_queue插件，注意设置x-max-priority属性，否则rabbitmq-server服务会crash。</li>
</ul>
</blockquote>
<p>权重队列比等级级队列自如，而且权重队列是可以当等级队列用的，反过来是不行的。在特殊情况权重队列无法替代等级队列，例如priority值一定要用high、low或者其他有意义的字符串来标识，而这类字符串的通用比较又不是正确的priority，除非基础环境支持良好的hack。能不能实现权重队列，就看容器里面的数据是否方便排序了。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/level/">level</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/priority/">priority</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/weight/">weight</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/分类/">分类</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/排序/">排序</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/backend-tool/">backend-tool</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-redis1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/02/redis1/" class="article-date">
  	<time datetime="2016-08-02T09:36:04.000Z" itemprop="datePublished">2016-08-02</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/02/redis1/">redis出坑记</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="monitor未关闭"><a href="#monitor未关闭" class="headerlink" title="monitor未关闭"></a>monitor未关闭</h2><p>redis的monitor运维调试用，返回服务器处理的每一个命令，能了解在数据库上发生了什么操作，所以在性能上会有一些消耗。有3种操作方法进monitor模式。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[lavenderuni@~]<span class="comment"># redis-cli monitor</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">[lavenderuni@~]<span class="comment"># redis-cli </span></span><br><span class="line">127.0.0.1:6379&gt; monitor</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">[lavenderuni@~]<span class="comment"># telnet 127.0.0.1 6379</span></span><br><span class="line">Trying 127.0.0.1...</span><br><span class="line">Connected to 127.0.0.1.</span><br><span class="line">Escape character is <span class="string">'^]'</span>.</span><br><span class="line">monitor</span><br></pre></td></tr></table></figure>

<p>在测试redis-cluster时候，吃午饭回来发现某node内存持续占用，比其他node要高，主node正常，如果在非常大的key-value，例如某个key的value存了近百万数据，会造成内存占用，但是不应该是某个node不正常。主从复制出问题应该体现在主node。</p>
<p>经过排查找到，是该node上开启了monitor模式，饭前忘了关掉，导致请求的操作log越来越多。这和很多工具都一样，测试模式不要轻易开启，用完请及时关闭。注意，Telnet连上了同样可以monitor，所以端口不要轻易对外开放，避免被人利用</p>
<h2 id="大map"><a href="#大map" class="headerlink" title="大map"></a>大map</h2><p>产品上面的用户数据超过700万，一些用户的附加信息需要在新功能上使用，并且新功能取数据很频繁，需要把用户这部分信息从mongo存到redis，供接口获取。<br>有三种方案：</p>
<blockquote>
<ul>
<li>key-value，key=uid，val=rank</li>
<li>hash，key=”userinfo”，val={uid:rank}</li>
<li>hash，key=to_int(uid)/60，val={to_int(uid)%60:rank}</li>
</ul>
</blockquote>
<p>通过测试发现，第三种的内存最小。<br>为什么呢？要从数据类型的内部存储方式说起，</p>
<ul>
<li>hash-max-zipmap-entries 64 </li>
<li>hash-max-zipmap-value 512</li>
</ul>
<p>hash-max-zipmap-entries含义是当value这个Map内部不超过多少个成员时会采用线性紧凑格式存储，默认是64，即value内部有64个以下的成员就是使用线性紧凑存储，超过该值自动转成真正的HashMap。</p>
<p>hash-max-zipmap-value 含义是当 value这个Map内部的每个成员值长度不超过多少字节就会采用线性紧凑存储来节省空间。</p>
<p>以上2个条件任意一个条件超过设置值都会转换成真正的HashMap，也就不会再节省内存了。它们值不是越大越好，HashMap的各种动作的时间复杂度都是O(1)，采用一维存储的时间复杂度O(n)，成员数量一多，会严重影响性能。</p>
<p>因此遇到Redis的大map，要选择合理的数据结构和hash-max-zipmap参数解决实际问题，达到高效省内存的目的。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hash优化/">hash优化</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/monitor/">monitor</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/backend-tool/">backend-tool</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-axing" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/01/axing/" class="article-date">
  	<time datetime="2016-08-01T01:45:37.000Z" itemprop="datePublished">2016-08-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/01/axing/">星爷的背影变小了</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <style>
    p{text-indent: 2em;}
    img[title="wukong"] {width: 95%;}
</style>

<center style="font-size:2em;">咦 星爷的背影变小了</center>

<p><img src="/2016/08/01/axing/wukong.jpg" alt="wukong"></p>
<p>浮夸自虐虐他的草根形态和赤裸裸的真我是星爷电影的精华，又叫无厘头，比鲁迅眼里的阿Q，要酣畅淋漓，好比阿Q是一只在人群夹缝里面狼狈乱窜的落水狗，而阿星是一直雄赳赳、气昂昂的落水狗，边抖着身上的水，边叫道：“我落水了，大家快来打我啊，好好笑。”</p>
<p>相形之行，鲁迅指出了百姓的劣根性；而星爷说劣根性的人也可以自强，也可以快乐，也可以精彩。在某种世界形态里，鲁迅留下的是一副苦药，让人无地自容；星爷却戏谑地赞他可爱，让虾米们再度活蹦乱跳起来。</p>
<p>虾米们起身看到的，却是星爷渐行渐远渐老的背影。</p>
<p>我记得第一次接触到星爷的电影是《大话西游•月光宝盒》，小时候五年级的时候吧，我和表姐采完茶，回到家里，看到14寸的黑白电视上正在播，当时觉得孙悟空的造型实在是没有六小龄童的美感啊，疯疯癫癫的对白啰里啰嗦，音乐造型呢，有一种唱戏的感觉，故事情节和打斗场面远不如金庸的流畅精彩。那一遍真没留下什么印象，或者好印象，哪知若干年以后被感动得一塌糊涂。</p>
<blockquote>
<p>以下是1992-2004部分作品</p>
</blockquote>
<ul>
<li><p><strong>审死官、九品芝麻官</strong>，都是对体制权力的讽刺，无奈的败笔是最后胜利也要依靠更高的权力。这两部电影抛弃过往审案剧里那种凛然正气的权力，例如样板化的《包青天》，而是凸出智斗奸邪，借力打力的辛酸历程，更多的体现逻辑和民心所问。<br>  经典桥段：</p>
<ul>
<li>财主找宋世杰帮有罪的儿子打官司，拿出一箱银子，宋世杰不屑一顾，财主拿出一箱金子，宋世杰略有触动，财主出两车黄金。宋世杰坚定迅速接道：“那怎么行！”宋妻大喜老公有骨气，宋世杰却又说了句让所有人绝倒的话：“输了我也要一半！”</li>
<li>宋世杰在衙门牌匾“光明正大”四个字下流了眼泪，感慨道：“官啊！…..”</li>
<li>包龙星拿出一条内裤道：“我之所以有明天的成果，全多得皇上选拔，我对他呢，非常惦念，还好我收藏了一条皇上的龙内裤，闻一闻，精神百倍，抖一抖，生动筋骨，舔一舔，不会四处乱摆。来，闻一闻。”老板娘：“恩。”仆人道：“恬亲王到。”包龙星：“王爷大驾光临，有失远迎，恕罪，恕罪。”恬亲王道：“不必多礼，明天你开业，我不能恭喜你，要告知你一个坏消息，皇上驾崩了。”包龙星用龙内裤擦泪：“啊！皇上怎么会这样？怎么这样？皇上怎么会驾崩呢？”恬亲王：“生病了。”包龙星：“什么病呀？ ”恬亲王：“是花柳病。”包龙星：“哎呀。”赶紧扔掉龙内裤。</li>
</ul>
</li>
<li><p><strong>唐伯虎点秋香、月光宝盒、仙履奇缘</strong>对老传说改编，无疑，只有星爷才能改编得这么不一样，这么让人回味。<br>  经典桥段：</p>
<ul>
<li>旺财和小强，对社会病态比惨的讽刺，救济穷弱需要一套合理完善的制度助人自强，而不是作秀或者选秀，例如最惨最贫困之类的，也不是主观地干涉。</li>
<li>打劫脚底板，二郎神的哮天犬奔着母狗去…..都是创意啊。</li>
<li>一万年的誓言，是浑小子的最爱。</li>
<li>紫霞仙子：“你看那个人，好奇怪哟，像一条狗。”</li>
<li>紫霞仙子：“我的意中人是个盖世英雄，有一天他会踩着七色云彩来娶我，我只猜中了前头，可是我却猜不中这结局。”</li>
</ul>
</li>
<li><p><strong>大内密探、国产凌凌漆</strong>，原来007可以不那么潇洒，却可以这么奇葩，不优秀也可以完成任务。<br>  经典桥段：</p>
<ul>
<li>让人想死的后宫佳丽三千，貌似历史上的后宫比片中的情形好不了多少。</li>
<li>一段模仿奥斯卡颁奖的场面，最佳男主角是片中男主角的岳父。</li>
<li>妓女道：“你以为躲起来就找不到你了吗？没有用的！象你这样拉风的男人，无论在什么地方，都像漆黑中的萤火虫一样，那样的鲜明，那样的出众。你那忧郁的眼神，稀嘘的胡喳子，神乎其神的刀法，和那杯Dry Martine，都深深地迷住了我。不过，虽然这是这样的出色，但是行有行规，无论怎样你要付清昨晚的过夜费呀，叫鸡不用给钱吗？”</li>
<li>007那些一会儿正常一会儿不正常的工具和飞刀绝技。</li>
<li>司令和李香琴用马桶通讯，道：“闭嘴，你以什么身份来问我，他是什么人跟你有什么关系？你妈妈是汉奸，你爸爸是走狗，你爷爷是卖国贼，你就是汉奸、走狗、卖国贼的生的，永远不能改变，当年要不是我收留你，你早就跟他们一起完蛋啦，你的命是我捡回来的，我叫你怎么办你就怎么办，知不知道？阿琴，我知道你这个人有时候心肠太软，你知不知道007是个什么样的的人？他是一个衣冠禽兽、他以前无恶不作，不但强奸大肚子，而且非礼小女孩，你看看，这些小女孩多可爱啊！这些大肚子又多凄残，都是他干的好事呀。你现在可以说是为民除害，你还有什么问题没有？”</li>
<li>刑场，第一个瞎子被认定偷看机密文件，被枪毙。第二个官二代，还是被枪毙。第三个武林高手要跑路，被炮轰了。末了，007用一张钞票全身而退。</li>
</ul>
</li>
<li><p><strong>喜剧之王、少林足球、功夫</strong>，草根的奋斗生活，像极了阿Q，尤其是《功夫》里面的阿星，却不是一个边顺从边逃避的阿Q，而是有点流氓气，有点善良，不停挣扎反抗的阿Q。<br>  经典桥段：</p>
<ul>
<li>尹天仇对柳飘飘：“其实我是一个演员。”</li>
<li>用演技教一个斯文人去收保护费。</li>
<li>命运真是不公平，为什么我这么帅却要掉头发，你们长的那么丑却不掉头发。</li>
<li>赵薇：“我想帮你们比赛。”周星驰：“你怎么帮？你快点回火星吧，地球是很危险滴。”</li>
<li>阿星和肥仔收租欺软怕硬，暗箭自伤。</li>
<li>乞丐道：“小子，我看你骨骼惊奇，必是练武奇才，将来维护宇宙正义与和平的重任就交给你了！我这有本《如来神掌》，原价13块8，算你10块钱一本！”讽刺的是套路。</li>
<li>包租婆：“你以为会功夫就不是兔子吗？”裁缝哭了：“会功夫不是罪啊。”包租婆：“你一日是兔子，终生是兔子。你看看你，穿条红内裤，白里透红，出来庆功吗？”</li>
</ul>
</li>
</ul>
<blockquote>
<p>以下是2008-2016部分作品</p>
</blockquote>
<ul>
<li><strong>长江7号</strong>，算是温馨的，塑造的底层人物不错但是不够精彩。</li>
<li><strong>西游·降魔篇</strong>，为了搞笑而搞笑，越是迎合众人，越是容易失宠。</li>
<li><strong>美人鱼</strong>，不搞笑，除了票房高，还能想起什么呢？张雨绮的大胸。</li>
</ul>
<p>星爷的电影是怎么了，越来越商业化，越来越没有味道了。</p>
<p>星爷老了吗？如果逃不过所谓的事业人生起伏定律，请您快快好起来，请您继续聚焦底层人民的生活，请您继续把世事的泪点转换成笑点吧，例如母亲卖姐姐，妹妹帮着数钱；卖肾买苹果；儿子是隔壁老王的……</p>
<p>星爷，千万万个我一直站在您的背后。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/周星驰/">周星驰</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/浮夸/">浮夸</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/自虐/">自虐</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/杂货/">杂货</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-spider1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/07/28/spider1/" class="article-date">
  	<time datetime="2016-07-28T14:41:09.000Z" itemprop="datePublished">2016-07-28</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/28/spider1/">爬虫之路（1）</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <style>
    p{text-indent: 2em;}
    img[title="wukong"] {width: 95%;}
</style>

<p>requests、lxml、phantomjs是Python爬虫的基础，也是利器。</p>
<h2 id="requests-vs-pycurl"><a href="#requests-vs-pycurl" class="headerlink" title="requests vs pycurl"></a>requests vs pycurl</h2><p>pycurl除了快，没有什么好。requests除了没有pycurl快，什么都好。<br>pycurl是用c语言写的，速度很快，比urllib和httplib都快，requests是基于urllib构建的，所以requests比pycurl慢。</p>
<p>pycurl的例子</p>
<figure class="highlight bash"><figcaption><span>python</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt;&gt;&gt; import StringIO</span><br><span class="line">&gt;&gt;&gt; import pycurl</span><br><span class="line">&gt;&gt;&gt; c = pycurl.Curl()</span><br><span class="line">&gt;&gt;&gt; str = StringIO.StringIO()</span><br><span class="line">&gt;&gt;&gt; c.setopt(pycurl.URL, <span class="string">"http://t.cn/aKln8T"</span>)</span><br><span class="line">&gt;&gt;&gt; c.setopt(pycurl.WRITEFUNCTION, str.write)</span><br><span class="line">&gt;&gt;&gt; c.setopt(pycurl.FOLLOWLOCATION, 1)</span><br><span class="line">&gt;&gt;&gt; c.perform()</span><br><span class="line">&gt;&gt;&gt; <span class="built_in">print</span> c.getinfo(pycurl.EFFECTIVE_URL)</span><br><span class="line">http://www.ladymax.cn/bbs/thread-46253-1-1.html</span><br></pre></td></tr></table></figure>

<p>requests的例子</p>
<figure class="highlight bash"><figcaption><span>python</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt;&gt;&gt; import requests</span><br><span class="line">&gt;&gt;&gt; requests.get(<span class="string">"http://t.cn/aKln8T"</span>).url</span><br><span class="line">http://www.ladymax.cn/bbs/thread-46253-1-1.html</span><br></pre></td></tr></table></figure>

<p>很明显requests用起来简洁直观。requests可以模拟实现restful的get，post，put，delete请求，并且可以通过post的file参数模拟上传，可以伪造headers、cookies。是否开启https用verify参数。是否允许重定向，使用allow_redirects参数。并且requests支持session，提供系列请求共同认证。</p>
<h2 id="lxml-vs-beautifulsoup-vs-pyquery"><a href="#lxml-vs-beautifulsoup-vs-pyquery" class="headerlink" title="lxml vs beautifulsoup vs pyquery"></a>lxml vs beautifulsoup vs pyquery</h2><ul>
<li><p>beautifulsoup太慢，测试发现beautifulsoup比lxml要慢10多倍，lxml调用的libxml2+libxslt的原生c代码比较快。</p>
</li>
<li><p>beautifulsoup太耗内存，我在对接美团的团购开放api的时候，发现一个几十m的xml在beautifulsoup里面构建dom树几乎把服务器的内存都耗尽了，换成lxml就666。</p>
</li>
<li><p>beautifulsoup解析特殊符号或者字符串，会出现非正常的返回值。遇到这种情况，找到出问题的位置，然后在项目里面hack就行了。反观lxml的xpath太酸爽了。</p>
</li>
<li><p>pyquery依赖lxml，唯一的特点是完全的类jquery调用方式。</p>
</li>
</ul>
<p>lxml的多线程有重入性问题，可以hack，将原来的各种变量放到thread local里面，实现参照webcral的<a href="https://github.com/listen-lavender/webcrawl/blob/master/webcrawl/lxmlclean.py" target="_blank" rel="noopener">lxmlclean</a>。<br>另外，beautifulsoup4可以选用lxml方式做解析。pyquery可以做试验品用。lxml适合大规模应用。</p>
<h2 id="phantomjs-vs-ghost-py"><a href="#phantomjs-vs-ghost-py" class="headerlink" title="phantomjs vs ghost.py"></a>phantomjs vs ghost.py</h2><p>不是所有的数据都是取自html、lxml，也可以取自json api，也不是所有的json api就是找到url就能拿回来的，比如说去哪儿的api基本上都做前后端混合加密，想通过json api取数据，基本办不到。还是得考虑如何在后台渲染页面dom文档，把数据取出来。<br>可以采用phantomjs，一种无头浏览器，实现了Selenium的大部分功能，Selenium是HTML测试工具。phantomjs能将一个url地址，在后台渲染完成，包括等候各个json api取数据完成。phantomjs能支持编写函数接口实现点击拖拽等各种用户操作。<br>ghost.py是Python版本的PhantomJS，基本实现了PhantomJS的功能，有以下不足。</p>
<ul>
<li><p>相同的引用链接请求会请求多次。</p>
</li>
<li><p>对于异步数据请求的执行，兼容性不够，无法捕获异步加载js文件的请求。</p>
</li>
<li><p>请求超时控制的问题比PhantomJS更严重，不请求完成就拿不到数据。</p>
</li>
</ul>
<p>phantomjs和python的结合实现参照webcral的<a href="https://github.com/listen-lavender/webcrawl/blob/master/webcrawl/request.py" target="_blank" rel="noopener">request from phantomjs proxy</a>和<a href="https://github.com/listen-lavender/webcrawl/blob/master/bin/browse" target="_blank" rel="noopener">phantomjs proxy</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/lxml/">lxml</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/phantomjs/">phantomjs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/requests/">requests</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/spider/">spider</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-pyise" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/07/07/pyise/" class="article-date">
  	<time datetime="2016-07-07T00:54:07.000Z" itemprop="datePublished">2016-07-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/07/pyise/">python is VS ==</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <style>
    img[title="pyiseid"] {width: 55%;}
</style>

<p>python的世界里，一切皆指针，一切皆对象</p>
<h2 id="python的对象三要素：id、type、value。"><a href="#python的对象三要素：id、type、value。" class="headerlink" title="python的对象三要素：id、type、value。"></a>python的对象三要素：id、type、value。</h2><blockquote>
<ul>
<li>id，标识一个对象，寻址的指针</li>
<li>type，对象类型</li>
<li>value，对象值</li>
</ul>
</blockquote>
<h2 id="python-is"><a href="#python-is" class="headerlink" title="python is"></a>python is</h2><p>a is b 判断的是a对象是否就是b对象，是通过id寻址来判断的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_id</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'temporary int 1'</span>, id(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'temporary int 1'</span>, id(<span class="number">1</span>)</span><br><span class="line">    a = <span class="number">1</span></span><br><span class="line">    b = <span class="number">1</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'variable a 1'</span>, id(a)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'variable b 1'</span>, id(b)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'\n'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'temporary str ab'</span>, id(<span class="string">'ab'</span>)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'temporary str ab'</span>, id(<span class="string">'ab'</span>)</span><br><span class="line">    a = <span class="string">'ab'</span></span><br><span class="line">    b = <span class="string">'ab'</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'variable a ab'</span>, id(a)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'variable b ab'</span>, id(b)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'\n'</span></span><br><span class="line"></span><br><span class="line">    a = <span class="number">1</span></span><br><span class="line">    b = <span class="number">1</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'variable a reset 1'</span>, id(a)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'variable b reset 1'</span>, id(b)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'\n'</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_object</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">AB</span><span class="params">(object)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, c=<span class="number">1</span>, d=<span class="number">2</span>)</span>:</span></span><br><span class="line">            self.c = c</span><br><span class="line">            self.d = d</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'temporary list []'</span>, id([])</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'temporary list []'</span>, id([])</span><br><span class="line">    a = []</span><br><span class="line">    b = []</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'variable a []'</span>, id(a)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'variable b []'</span>, id(b)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'\n'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'temporary object of object'</span>, id(object())</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'temporary object of object'</span>, id(object())</span><br><span class="line">    a = object()</span><br><span class="line">    b = object()</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'variable a object()'</span>, id(a)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'variable b object()'</span>, id(b)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'\n'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'temporary object of AB'</span>, id(AB())</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'temporary object of AB'</span>, id(AB())</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'temporary object of AB'</span>, id(AB(<span class="number">2</span>))</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'temporary object of AB'</span>, id(AB(<span class="number">3</span>))</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'temporary object of AB'</span>, id(AB(<span class="number">4</span>, <span class="number">5</span>))</span><br><span class="line">    a = AB()</span><br><span class="line">    b = AB()</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'variable a AB()'</span>, id(a)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'variable b AB()'</span>, id(b)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'\n'</span></span><br><span class="line"></span><br><span class="line">    a = []</span><br><span class="line">    b = []</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'variable a reset []'</span>, id(a)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'variable b reset []'</span>, id(b)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'\n'</span></span><br><span class="line"></span><br><span class="line">    a = object()</span><br><span class="line">    b = object()</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'variable a reset object()'</span>, id(a)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'variable b reset object()'</span>, id(b)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'\n'</span></span><br><span class="line"></span><br><span class="line">    a = AB()</span><br><span class="line">    b = AB()</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'variable a reset Ab()'</span>, id(a)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'variable b reset AB()'</span>, id(b)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'\n'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    test_id()</span><br><span class="line">    test_object()</span><br></pre></td></tr></table></figure>

<p>python里面的匿名变量的分配是幂等的<br>一般情况，系统类型匿名变量，就是所谓的常量，每一种类型的每一种值在每一个进程里面只存在一个匿名变量，并且可以被具名变量无限赋值引用；例如1, 2, ‘a’, 0.123；自定义类型匿名变量，每一种类型在每一个进程里面只存在一个匿名变量，最多能被一个具名变量赋值引用；系统常量是匿名变量的子集（在python shell里面表现比较奇怪）</p>
<h2 id="python"><a href="#python" class="headerlink" title="python =="></a>python ==</h2><p>a == b 判断的是a对象的值是否和b对象的值相等，是通过value来判断的</p>
<h2 id="is-vs"><a href="#is-vs" class="headerlink" title="is vs =="></a>is vs ==</h2><pre><code>为什么是 is None?</code></pre><figure class="highlight bash"><figcaption><span>python</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt;&gt;&gt; c = None</span><br><span class="line">&gt;&gt;&gt; c == None</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; c is None</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; c = 1</span><br><span class="line">&gt;&gt;&gt; c == 1</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; c is 1</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; c = <span class="string">'ab'</span></span><br><span class="line">&gt;&gt;&gt; c == <span class="string">'ab'</span></span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; c is <span class="string">'ab'</span></span><br><span class="line">True</span><br></pre></td></tr></table></figure>

<p>对于系统常量的判断，== 等价于 is，而且 is的效率 &gt; == 的效率，因为is是寻址判断，==先要通过id找到存储位置，再比较存储位置的值；</p>
<p>为什么不是 is 1，is ‘a’<br>估计是使用习惯的问题，对于系统常量的相等判断，is 1比 ==1更合适</p>
<p>有趣的python shell现象<br><img src="/2016/07/07/pyise/id.png" alt="pyiseid"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/">==</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/is/">is</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/使用场景/">使用场景</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/匿名变量/">匿名变量</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/性能/">性能</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/python/">python</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/3/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2020 listen
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
    <script type="text/javascript">
      (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
      (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
      e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
      })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
      
      _st('install','hPJFSMYvMX8XnCRm-L2e','2.0.0');
    </script>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>