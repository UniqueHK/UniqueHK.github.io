<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>宽视角</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="年轻是什么？就是越挫越勇！">
<meta property="og:type" content="website">
<meta property="og:title" content="宽视角">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="宽视角">
<meta property="og:description" content="年轻是什么？就是越挫越勇！">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="宽视角">
<meta name="twitter:description" content="年轻是什么？就是越挫越勇！">
  
    <link rel="alternative" href="/atom.xml" title="宽视角" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	
		<form class="search" action="/search/index.html" method="get" accept-charset="utf-8">
			<label>Search</label>
			<input type="text" id="st-search-input" class="st-default-search-input st-search-input_my" maxlength="30" placeholder="Search" />
		</form>
	
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="https://avatars1.githubusercontent.com/u/4168558?v=3&amp;s=460" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">宽视角</a></h1>
		</hgroup>

		
        <h3 style="font-weight:bold;font-style:italic;" class="header-subtitle">listen</h3>
        

		
		<p class="header-subtitle">年轻是什么？就是越挫越勇！</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						<li>Links</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/listen-lavender" title="github">github</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/" style="font-size: 10px;">==</a> <a href="/tags/DAG/" style="font-size: 10px;">DAG</a> <a href="/tags/FP/" style="font-size: 10px;">FP</a> <a href="/tags/LRU-cache/" style="font-size: 10px;">LRU cache</a> <a href="/tags/Newton-iteration/" style="font-size: 10px;">Newton iteration</a> <a href="/tags/OOP/" style="font-size: 10px;">OOP</a> <a href="/tags/Slice分布式/" style="font-size: 10px;">Slice分布式</a> <a href="/tags/Time-Quantum/" style="font-size: 10px;">Time Quantum</a> <a href="/tags/async-task/" style="font-size: 10px;">async task</a> <a href="/tags/asynchronous/" style="font-size: 10px;">asynchronous</a> <a href="/tags/asyncio/" style="font-size: 10px;">asyncio</a> <a href="/tags/authority/" style="font-size: 10px;">authority</a> <a href="/tags/background/" style="font-size: 10px;">background</a> <a href="/tags/beanstalkd/" style="font-size: 10px;">beanstalkd</a> <a href="/tags/binary-search/" style="font-size: 10px;">binary search</a> <a href="/tags/bit/" style="font-size: 10px;">bit</a> <a href="/tags/bitmap/" style="font-size: 20px;">bitmap</a> <a href="/tags/brpop/" style="font-size: 10px;">brpop</a> <a href="/tags/cache-algorithm/" style="font-size: 10px;">cache algorithm</a> <a href="/tags/cell/" style="font-size: 10px;">cell</a> <a href="/tags/column/" style="font-size: 10px;">column</a> <a href="/tags/comet-streaming/" style="font-size: 10px;">comet streaming</a> <a href="/tags/complicated/" style="font-size: 10px;">complicated</a> <a href="/tags/concurrently/" style="font-size: 10px;">concurrently</a> <a href="/tags/context/" style="font-size: 10px;">context</a> <a href="/tags/coroutine/" style="font-size: 10px;">coroutine</a> <a href="/tags/csrf/" style="font-size: 10px;">csrf</a> <a href="/tags/dag/" style="font-size: 10px;">dag</a> <a href="/tags/data-pipeline/" style="font-size: 10px;">data pipeline</a> <a href="/tags/datamodel/" style="font-size: 10px;">datamodel</a> <a href="/tags/distributed/" style="font-size: 10px;">distributed</a> <a href="/tags/dynamic/" style="font-size: 10px;">dynamic</a> <a href="/tags/extract/" style="font-size: 10px;">extract</a> <a href="/tags/flexible/" style="font-size: 10px;">flexible</a> <a href="/tags/frame/" style="font-size: 10px;">frame</a> <a href="/tags/gen-coroutine/" style="font-size: 10px;">gen.coroutine</a> <a href="/tags/goroutine/" style="font-size: 10px;">goroutine</a> <a href="/tags/greenlet/" style="font-size: 10px;">greenlet</a> <a href="/tags/gunicorn/" style="font-size: 10px;">gunicorn</a> <a href="/tags/hashtable/" style="font-size: 10px;">hashtable</a> <a href="/tags/hash优化/" style="font-size: 10px;">hash优化</a> <a href="/tags/hash制度/" style="font-size: 10px;">hash制度</a> <a href="/tags/header/" style="font-size: 10px;">header</a> <a href="/tags/http1-0/" style="font-size: 10px;">http1.0</a> <a href="/tags/http1-1/" style="font-size: 10px;">http1.1</a> <a href="/tags/http2-0/" style="font-size: 10px;">http2.0</a> <a href="/tags/include/" style="font-size: 10px;">include</a> <a href="/tags/index/" style="font-size: 20px;">index</a> <a href="/tags/interface/" style="font-size: 10px;">interface</a> <a href="/tags/ioloop/" style="font-size: 10px;">ioloop</a> <a href="/tags/is/" style="font-size: 10px;">is</a> <a href="/tags/json/" style="font-size: 10px;">json</a> <a href="/tags/judge/" style="font-size: 10px;">judge</a> <a href="/tags/keyexpired/" style="font-size: 10px;">keyexpired</a> <a href="/tags/learning/" style="font-size: 10px;">learning</a> <a href="/tags/level/" style="font-size: 20px;">level</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/long-polling/" style="font-size: 10px;">long polling</a> <a href="/tags/lpush/" style="font-size: 10px;">lpush</a> <a href="/tags/lxml/" style="font-size: 10px;">lxml</a> <a href="/tags/mergelist/" style="font-size: 10px;">mergelist</a> <a href="/tags/method/" style="font-size: 10px;">method</a> <a href="/tags/mongo/" style="font-size: 10px;">mongo</a> <a href="/tags/mongo-id/" style="font-size: 10px;">mongo_id</a> <a href="/tags/monitor/" style="font-size: 10px;">monitor</a> <a href="/tags/mq通信/" style="font-size: 10px;">mq通信</a> <a href="/tags/multi-process/" style="font-size: 10px;">multi process</a> <a href="/tags/nosql/" style="font-size: 10px;">nosql</a> <a href="/tags/object-oriented/" style="font-size: 10px;">object-oriented</a> <a href="/tags/off-schedule/" style="font-size: 10px;">off-schedule</a> <a href="/tags/package/" style="font-size: 10px;">package</a> <a href="/tags/parallel/" style="font-size: 10px;">parallel</a> <a href="/tags/parametrized/" style="font-size: 10px;">parametrized</a> <a href="/tags/performance/" style="font-size: 10px;">performance</a> <a href="/tags/phantomjs/" style="font-size: 10px;">phantomjs</a> <a href="/tags/pointer/" style="font-size: 10px;">pointer</a> <a href="/tags/pointerarray/" style="font-size: 10px;">pointerarray</a> <a href="/tags/powerful/" style="font-size: 10px;">powerful</a> <a href="/tags/priority/" style="font-size: 20px;">priority</a> <a href="/tags/procedure-oriented/" style="font-size: 10px;">procedure-oriented</a> <a href="/tags/property/" style="font-size: 10px;">property</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/queue/" style="font-size: 10px;">queue</a> <a href="/tags/recursive-struct/" style="font-size: 10px;">recursive struct</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/regex/" style="font-size: 10px;">regex</a> <a href="/tags/requests/" style="font-size: 10px;">requests</a> <a href="/tags/row/" style="font-size: 10px;">row</a> <a href="/tags/rpc通信/" style="font-size: 10px;">rpc通信</a> <a href="/tags/rwx/" style="font-size: 10px;">rwx</a> <a href="/tags/setter-getter/" style="font-size: 10px;">setter/getter</a> <a href="/tags/shell-script/" style="font-size: 10px;">shell script</a> <a href="/tags/signatures/" style="font-size: 10px;">signatures</a> <a href="/tags/specific-type/" style="font-size: 10px;">specific type</a> <a href="/tags/sqrt/" style="font-size: 10px;">sqrt</a> <a href="/tags/task/" style="font-size: 10px;">task</a> <a href="/tags/task-flow/" style="font-size: 10px;">task flow</a> <a href="/tags/threading/" style="font-size: 10px;">threading</a> <a href="/tags/type-assert/" style="font-size: 10px;">type assert</a> <a href="/tags/urlparameter/" style="font-size: 10px;">urlparameter</a> <a href="/tags/websocket/" style="font-size: 10px;">websocket</a> <a href="/tags/weight/" style="font-size: 10px;">weight</a> <a href="/tags/workflow/" style="font-size: 10px;">workflow</a> <a href="/tags/worthy/" style="font-size: 10px;">worthy</a> <a href="/tags/上/" style="font-size: 10px;">上</a> <a href="/tags/两小无猜/" style="font-size: 10px;">两小无猜</a> <a href="/tags/乌托邦/" style="font-size: 10px;">乌托邦</a> <a href="/tags/人生半坡/" style="font-size: 10px;">人生半坡</a> <a href="/tags/优先级/" style="font-size: 10px;">优先级</a> <a href="/tags/使用场景/" style="font-size: 10px;">使用场景</a> <a href="/tags/先验概率/" style="font-size: 10px;">先验概率</a> <a href="/tags/全概率/" style="font-size: 10px;">全概率</a> <a href="/tags/冲突/" style="font-size: 10px;">冲突</a> <a href="/tags/减法/" style="font-size: 10px;">减法</a> <a href="/tags/分布式/" style="font-size: 10px;">分布式</a> <a href="/tags/分支限界/" style="font-size: 10px;">分支限界</a> <a href="/tags/分治/" style="font-size: 10px;">分治</a> <a href="/tags/分类/" style="font-size: 10px;">分类</a> <a href="/tags/动态规划/" style="font-size: 10px;">动态规划</a> <a href="/tags/努力/" style="font-size: 10px;">努力</a> <a href="/tags/匿名变量/" style="font-size: 10px;">匿名变量</a> <a href="/tags/单线程/" style="font-size: 10px;">单线程</a> <a href="/tags/后验概率/" style="font-size: 10px;">后验概率</a> <a href="/tags/周星驰/" style="font-size: 10px;">周星驰</a> <a href="/tags/哈希/" style="font-size: 10px;">哈希</a> <a href="/tags/回溯/" style="font-size: 10px;">回溯</a> <a href="/tags/多线程/" style="font-size: 10px;">多线程</a> <a href="/tags/富类hash/" style="font-size: 10px;">富类hash</a> <a href="/tags/小巧/" style="font-size: 10px;">小巧</a> <a href="/tags/嵌入式脚本/" style="font-size: 10px;">嵌入式脚本</a> <a href="/tags/异步IO/" style="font-size: 10px;">异步IO</a> <a href="/tags/张小凡/" style="font-size: 10px;">张小凡</a> <a href="/tags/性能/" style="font-size: 10px;">性能</a> <a href="/tags/排序/" style="font-size: 10px;">排序</a> <a href="/tags/新年快乐/" style="font-size: 10px;">新年快乐</a> <a href="/tags/条件查询/" style="font-size: 10px;">条件查询</a> <a href="/tags/条件概率/" style="font-size: 10px;">条件概率</a> <a href="/tags/浮夸/" style="font-size: 10px;">浮夸</a> <a href="/tags/混沌hash/" style="font-size: 10px;">混沌hash</a> <a href="/tags/热加载/" style="font-size: 10px;">热加载</a> <a href="/tags/父类方法调用子类方法/" style="font-size: 10px;">父类方法调用子类方法</a> <a href="/tags/状态/" style="font-size: 10px;">状态</a> <a href="/tags/田灵儿/" style="font-size: 10px;">田灵儿</a> <a href="/tags/自省自乐/" style="font-size: 10px;">自省自乐</a> <a href="/tags/自虐/" style="font-size: 10px;">自虐</a> <a href="/tags/贪心/" style="font-size: 10px;">贪心</a> <a href="/tags/转码/" style="font-size: 10px;">转码</a> <a href="/tags/阻塞完成/" style="font-size: 10px;">阻塞完成</a> <a href="/tags/随心随性/" style="font-size: 10px;">随心随性</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://braavos.me/">落在深海</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://sanyuesha.com/">三月沙</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">listen</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="https://avatars1.githubusercontent.com/u/4168558?v=3&amp;s=460" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">listen</h1>
			</hgroup>
			
			<p class="header-subtitle">年轻是什么？就是越挫越勇！</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/listen-lavender" title="github">github</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-linux2" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/01/21/linux2/" class="article-date">
  	<time datetime="2017-01-21T13:26:44.000Z" itemprop="datePublished">2017-01-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/21/linux2/">multi process from shell script in parallel in background</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Failed test.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(workspace) ➜  cat test2.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span>((k=0;k&lt;5;k++));</span><br><span class="line">    <span class="keyword">do</span> sleep 1 &amp;;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">(workspace) ➜  sh test2.sh</span><br><span class="line">test2.sh: line 3: syntax error near unexpected token `;<span class="string">'</span></span><br><span class="line"><span class="string">test2.sh: line 3: `    do sleep 1 &amp;;'</span></span><br></pre></td></tr></table></figure>

<p>Here’s an easy command to fork off a bunch of jobs in parallel.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(workspace) ➜  cat test1.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">seq 10 20 | xargs -n 1 -P 5 sleep &amp;</span><br><span class="line">(workspace) ➜  sh test1.sh</span><br><span class="line">(workspace) ➜  ps -eff|grep sleep</span><br><span class="line">  501 75381     1   0  9:33下午 ttys001    0:00.00 xargs -n 1 -P 5 sleep</span><br><span class="line">  501 75383 75381   0  9:33下午 ttys001    0:00.00 sleep 10</span><br><span class="line">  501 75384 75381   0  9:33下午 ttys001    0:00.00 sleep 11</span><br><span class="line">  501 75385 75381   0  9:33下午 ttys001    0:00.00 sleep 12</span><br><span class="line">  501 75386 75381   0  9:33下午 ttys001    0:00.00 sleep 13</span><br><span class="line">  501 75387 75381   0  9:33下午 ttys001    0:00.00 sleep 14</span><br></pre></td></tr></table></figure>


      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/background/">background</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/multi-process/">multi process</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/parallel/">parallel</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell-script/">shell script</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/backend-tool/">backend-tool</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-gotest2" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/01/21/gotest2/" class="article-date">
  	<time datetime="2017-01-21T06:39:13.000Z" itemprop="datePublished">2017-01-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/21/gotest2/">go json转换</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="确定类型变换"><a href="#确定类型变换" class="headerlink" title="确定类型变换"></a>确定类型变换</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"encoding/json"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> F <span class="keyword">struct</span> &#123;</span><br><span class="line">    H <span class="keyword">string</span></span><br><span class="line">    K <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> A <span class="keyword">struct</span> &#123;</span><br><span class="line">    B <span class="keyword">string</span></span><br><span class="line">    C <span class="keyword">int</span></span><br><span class="line">    D <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span></span><br><span class="line">    E []<span class="keyword">int</span></span><br><span class="line">    F F</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    txt := <span class="string">`&#123;"b":"hello word","c":1,"d":&#123;"a":1,"b":2&#125;,"e":[2,3,4,5],"f":&#123;"h":"a","k":1&#125;&#125;`</span></span><br><span class="line">    <span class="keyword">var</span> ab A</span><br><span class="line">    json.Unmarshal([]<span class="keyword">byte</span>(txt), &amp;ab)</span><br><span class="line">    fmt.Println(ab.B)</span><br><span class="line">    fmt.Println(ab.C)</span><br><span class="line">    <span class="keyword">for</span> key, val := <span class="keyword">range</span>(ab.D)&#123;</span><br><span class="line">        fmt.Println(key, val)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> _, e := <span class="keyword">range</span>(ab.E)&#123;</span><br><span class="line">        fmt.Println(e)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(ab.F.H)</span><br><span class="line">    fmt.Println(ab.F.K)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>确定类型的转换，需要明确知道json文档会转成什么类型，可以嵌套，可以是自定义类型。比较适合文档数据库的模型对接。</p>
<h2 id="不确定类型变换"><a href="#不确定类型变换" class="headerlink" title="不确定类型变换"></a>不确定类型变换</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"encoding/json"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Decode</span><span class="params">(obj <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> k, v := <span class="keyword">range</span> obj &#123;</span><br><span class="line">        <span class="keyword">switch</span> vv := v.(<span class="keyword">type</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">string</span>:</span><br><span class="line">            fmt.Println(k, <span class="string">"is string"</span>, vv)</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">int</span>:</span><br><span class="line">            fmt.Println(k, <span class="string">"is int"</span>, vv)</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">float64</span>:</span><br><span class="line">            fmt.Println(k,<span class="string">"is float64"</span>,vv)</span><br><span class="line">        <span class="keyword">case</span> []<span class="keyword">interface</span>&#123;&#125;:</span><br><span class="line">            fmt.Println(k, <span class="string">"is an array:"</span>)</span><br><span class="line">            <span class="keyword">for</span> i, u := <span class="keyword">range</span> vv &#123;</span><br><span class="line">                fmt.Println(i, u)</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            fmt.Println(k, <span class="string">"is of a type I don't know how to handle"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    txt := <span class="string">`&#123;"a":1,"b":"hello","c":&#123;"a":1,"b":2.5&#125;,"d":["a","b","c"]&#125;`</span></span><br><span class="line">    <span class="keyword">var</span> ab <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">    json.Unmarshal([]<span class="keyword">byte</span>(txt), &amp;ab)</span><br><span class="line">    Decode(ab)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不确定类型的转换，不用知道json文档会转成什么类型，可以通过类型推断value.(type)或者reflect.ValueOf(value)搭配switch使用，不太好的是每个解析转换地方都要编码。</p>
<h2 id="递归模型变换"><a href="#递归模型变换" class="headerlink" title="递归模型变换"></a>递归模型变换</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"encoding/json"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">JsonDecode</span><span class="params">(str []<span class="keyword">byte</span>)</span> <span class="title">map</span>[<span class="title">string</span>]<span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">    <span class="keyword">var</span> dict <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">    err := json.Unmarshal(str, &amp;dict)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(err)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dict</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">JsonEncode</span><span class="params">(dict <span class="keyword">interface</span>&#123;&#125;)</span> []<span class="title">byte</span></span> &#123;</span><br><span class="line">    str, err := json.Marshal(dict)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(err)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println</span>(<span class="keyword">string</span>(str))</span><br><span class="line">    <span class="keyword">return</span> str</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> A <span class="keyword">struct</span> &#123;</span><br><span class="line">    B <span class="keyword">string</span></span><br><span class="line">    C <span class="keyword">int</span></span><br><span class="line">    D *A</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> a A</span><br><span class="line">    <span class="keyword">var</span> hk A</span><br><span class="line">    a = A&#123;</span><br><span class="line">        B:<span class="string">"hello word!"</span>,</span><br><span class="line">        C:<span class="number">1</span>,</span><br><span class="line">        D:&amp;A&#123;</span><br><span class="line">            B:<span class="string">"hello ABC"</span>,</span><br><span class="line">            C:<span class="number">2</span>,</span><br><span class="line">            D:<span class="literal">nil</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(a.B)</span><br><span class="line">    str, _ := json.Marshal(a)</span><br><span class="line">    <span class="built_in">println</span>(<span class="keyword">string</span>(str))</span><br><span class="line">    json.Unmarshal(str, &amp;hk)</span><br><span class="line">    fmt.Println(hk.D.B)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>递归类型的转换，允许深度的层次扩增，不允许广度的动态类型。</p>
<p>静态语言和动态语言的在json处理上体现的非常明显，动态语言处理实在太方便了，即开即用，而静态语言处理就比较吃力，但是实际上开发的时候，应该用确定的东西，尽量避开不确定，一劳永逸，类型推断方便使用的时候确定数据类型，递归模型处理还是不错的，某些特定场景很有用。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/json/">json</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/recursive-struct/">recursive struct</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/specific-type/">specific type</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/type-assert/">type assert</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/go/">go</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-bitauth" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/25/bitauth/" class="article-date">
  	<time datetime="2016-10-25T06:04:54.000Z" itemprop="datePublished">2016-10-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/25/bitauth/">Linux的文件权限设计思想</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[lavenderuni@~]<span class="comment"># ls -l bitauth.md</span></span><br><span class="line">-rw-r--r--  1 lavenderuni  staff  1137 10 25 14:43 bitauth.md</span><br></pre></td></tr></table></figure>

<ul>
<li>0 —  表示没有权限，二进制为000</li>
<li>1 –x  表示有执行权限，二进制为001</li>
<li>2 -w-  表示有写权限，二进制为010</li>
<li>3 -wx  表示有写和执行权限，二进制为011</li>
<li>4 r–  表示有读权限，二进制为100</li>
<li>5 r-x  表示有读和执行权限，二进制为101</li>
<li>6 rw-  表示有读和写权限，二进制为110</li>
<li>7 rwx  表示有读、写和执行权限，二进制为111</li>
</ul>
<p>假如给定一个数字6，3，4，如何判定在这个数字里面包含某一种权限呢？</p>
<h2 id="bit运算"><a href="#bit运算" class="headerlink" title="bit运算"></a>bit运算</h2><ul>
<li>读权限 r=4，二进制表示为100</li>
<li>写权限 w=2，二进制表示为010</li>
<li>执行权限x=1，二进制表示为001</li>
</ul>
<p>6表示为110<br>110 &amp; 100 = 100 = 4 !=0 有读权限<br>110 &amp; 010 = 010 = 2 !=0 有写权限<br>110 &amp; 001 = 000 = 0 ==0 没有执行权限</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bit_judge</span><span class="params">(auth_num)</span>:</span></span><br><span class="line">    auth_r = <span class="number">4</span></span><br><span class="line">    auth_w = <span class="number">2</span></span><br><span class="line">    auth_x = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    auth_str = <span class="string">''</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> auth_num &amp; auth_r == <span class="number">0</span>:</span><br><span class="line">        auth_str += <span class="string">'-'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        auth_str += <span class="string">'r'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> auth_num &amp; auth_w == <span class="number">0</span>:</span><br><span class="line">        auth_str += <span class="string">'-'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        auth_str += <span class="string">'w'</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> auth_num &amp; auth_x == <span class="number">0</span>:</span><br><span class="line">        auth_str += <span class="string">'-'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        auth_str += <span class="string">'x'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> auth_str</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">print</span> bit_judge(<span class="number">4</span>)</span><br><span class="line">    <span class="keyword">print</span> bit_judge(<span class="number">6</span>)</span><br></pre></td></tr></table></figure>

<h2 id="相除求余"><a href="#相除求余" class="headerlink" title="相除求余"></a>相除求余</h2><p>6表示为110<br>(6 / 4) % 2 ==1 有读权限<br>(6 / 2) % 2 ==1 有写权限<br>(6 / 1) % 2 ==0 没有执行权限</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dividemod_judge</span><span class="params">(auth_num)</span>:</span></span><br><span class="line">    auth_r = <span class="number">4</span></span><br><span class="line">    auth_w = <span class="number">2</span></span><br><span class="line">    auth_x = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    auth_str = <span class="string">''</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (auth_num / auth_r) % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">        auth_str += <span class="string">'r'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        auth_str += <span class="string">'-'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (auth_num / auth_w) % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">        auth_str += <span class="string">'w'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        auth_str += <span class="string">'-'</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (auth_num / auth_x) % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">        auth_str += <span class="string">'x'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        auth_str += <span class="string">'-'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> auth_str</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">print</span> dividemod_judge(<span class="number">6</span>)</span><br><span class="line">    <span class="keyword">print</span> dividemod_judge(<span class="number">4</span>)</span><br></pre></td></tr></table></figure>

<h1 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h1><p>mysql中数据设计类似权限数据，或者动态tag数据，都可以用多个bit位表示，是不是可以不用关联表，将数据降维，放在一个字段存储呢</p>
<p>公开 = 1<br>加密 = 2<br>封锁 = 4<br>置顶 = 8</p>
<ul>
<li>公开blog  给status进行或运算<br>update blog set status = status | 1; </li>
<li>加密blog 给status进行或运算<br>update blog set status = status | 2;</li>
<li>封锁blog<br>update blog set status = status | 4;</li>
<li>解锁blog<br>update blog set status = status ^ 4;</li>
<li>查询所有被置顶的blog<br>select * from blog where status &amp; 8;<br>等价于select * from blog where (status &amp; 8) != 0;</li>
</ul>
<p>缺点是查询的时候没有办法使用索引，因为位运算无法移动到=号的右边。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/authority/">authority</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bit/">bit</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/include/">include</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/judge/">judge</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rwx/">rwx</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/algorithm/">algorithm</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-linux1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/11/linux1/" class="article-date">
  	<time datetime="2016-10-11T04:04:50.000Z" itemprop="datePublished">2016-10-11</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/11/linux1/">ubuntu apt</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>问题</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Reading package lists... Error!</span><br><span class="line">W: GPG error: http://download.opensuse.org  Release: The following signatures couldn<span class="string">'t be verified because the public key is not available: NO_PUBKEY D54CC349F42D5F07</span></span><br><span class="line"><span class="string">E: Encountered a section with no Package: header</span></span><br><span class="line"><span class="string">E: Problem with MergeList /var/lib/apt/lists/packages.linuxmint.com_dists_qiana_import_i18n_Translation-en</span></span><br><span class="line"><span class="string">E: The package lists or status file could not be parsed or opened.</span></span><br><span class="line"><span class="string">Reading package lists... Error!</span></span><br><span class="line"><span class="string">E: Encountered a section with no Package: header</span></span><br><span class="line"><span class="string">E: Problem with MergeList /var/lib/apt/lists/packages.linuxmint.com_dists_qiana_import_i18n_Translation-en</span></span><br><span class="line"><span class="string">E: The package lists or status file could not be parsed or opened.</span></span><br></pre></td></tr></table></figure>

<p>解决方法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(workspace) ➜  ~ apt-key list | grep <span class="string">"expired:"</span></span><br><span class="line">(workspace) ➜  ~ apt-key adv --recv-keys --keyserver keys.gnupg.net <span class="string">"C300EE8C"</span></span><br><span class="line">(workspace) ➜  ~ apt-key adv --recv-keys --keyserver keys.gnupg.net <span class="string">"7BD9BF62"</span></span><br></pre></td></tr></table></figure>


      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/header/">header</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/keyexpired/">keyexpired</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mergelist/">mergelist</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/package/">package</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/signatures/">signatures</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/backend-tool/">backend-tool</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-algorithm" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/30/algorithm/" class="article-date">
  	<time datetime="2016-08-30T02:21:50.000Z" itemprop="datePublished">2016-08-30</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/30/algorithm/">五大常用算法</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="分治"><a href="#分治" class="headerlink" title="分治"></a>分治</h3><p>把一个复杂的问题分成两个或更多的相同或相似的子问题，再把子问题分成更小的子问题……直到最后子问题可以简单的直接求解，原问题的解即子问题的解的合并</p>
<h3 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h3><p>每次决策依赖于当前状态，又随即引起状态的转移。一个决策序列就是在变化的状态中产生出来的，所以，这种多阶段最优化决策解决问题的过程就称为动态规划</p>
<h3 id="贪心"><a href="#贪心" class="headerlink" title="贪心"></a>贪心</h3><p>在对问题求解时，总是做出在当前看来是最好的选择。也就是说，不从整体最优上加以考虑，他所做出的仅是在某种意义上的局部最优解。常见的贪心算法有：Prim算法、Kruskal算法（都是求最小生成树的）</p>
<h3 id="回溯"><a href="#回溯" class="headerlink" title="回溯"></a>回溯</h3><p>回溯算法实际上一个类似枚举的搜索尝试过程，主要是在搜索尝试过程中寻找问题的解，当发现已不满足求解条件时，就“回溯”返回，尝试别的路径</p>
<h3 id="分支限界"><a href="#分支限界" class="headerlink" title="分支限界"></a>分支限界</h3><p>类似于回溯法，也是一种在问题的解空间树T上搜索问题解的算法。但在一般情况下，分支限界法与回溯法的求解目标不同。回溯法的求解目标是找出T中满足约束条件的所有解，而分支限界法的求解目标则是找出满足约束条件的一个解，或是在满足约束条件的解中找出使某一目标函数值达到极大或极小的解，即在某种意义下的最优解</p>
<hr>
<p>分治和贪心算法其实都是map-reduce的过程，分治的reduce是compare出最优的，贪心算法的reduce是sum(*局部最优解)，属于广度优先；回溯和分支限界都属于深度优先；动态规划是一种复杂的形态，暂时未有好的概括，敬请期待。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/分支限界/">分支限界</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/分治/">分治</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/动态规划/">动态规划</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/回溯/">回溯</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/贪心/">贪心</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/theory/">theory</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-http" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/30/http/" class="article-date">
  	<time datetime="2016-08-30T02:21:16.000Z" itemprop="datePublished">2016-08-30</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/30/http/">http</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="http-long-polling"><a href="#http-long-polling" class="headerlink" title="http long polling"></a>http long polling</h2><ul>
<li>单个请求的超时时间尽量长一些</li>
<li>每个请求在接收回调里面发起下一个请求</li>
<li>服务端对于该请求用一个全局队列缓存数据</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[lavenderuni@~]<span class="comment"># cd longpolling</span></span><br><span class="line">[lavenderuni@~]<span class="comment"># python run.py</span></span><br><span class="line"></span><br><span class="line">浏览器打开http://localhost:8888/static/demo.html</span><br></pre></td></tr></table></figure>

<h2 id="http-comet-streaming"><a href="#http-comet-streaming" class="headerlink" title="http comet streaming"></a>http comet streaming</h2><ul>
<li>请求发送完成后，保持连接keep-alive</li>
<li>保持连接过程中，服务端可以不断推送数据到客户端</li>
<li>结束标志是发送了多少数据，是否到了业务边界</li>
<li>web端目前靠xmlhttprequest的readyState=3来接收数据</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[lavenderuni@~]<span class="comment"># cd streaming</span></span><br><span class="line">[lavenderuni@~]<span class="comment"># python run.py</span></span><br><span class="line"></span><br><span class="line">浏览器打开http://localhost:8888/static/demo.html</span><br></pre></td></tr></table></figure>

<h2 id="http1-1-pipeline"><a href="#http1-1-pipeline" class="headerlink" title="http1.1 pipeline"></a>http1.1 pipeline</h2><p>通过同一个tcp数据包发送多个http请求，http管线化向网络上发送更少的tcp数据包，以便减轻网络负载</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="http2"><a href="#http2" class="headerlink" title="http2"></a>http2</h2><ul>
<li>一个HTTP/2连接可保持多个stream</li>
<li>流可被客户端或服务器单独或共享创建和使用</li>
<li>流可被任一端关闭</li>
<li>在流内发送和接收数据都要按照顺序</li>
<li>流的标识符自然数表示，1~2^31-1区间，有创建流的终端分配</li>
<li>流与流之间逻辑上是并行、独立存在</li>
<li>流有优先级（priority），优先级高的先处理</li>
<li>流的并发数最好多于100</li>
<li>流量控制阀协调网络带宽资源利用，由接收端提出发送端遵守其规则</li>
<li>流具有完整的生命周期，从创建到最终关闭，经历不同阶段</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="websocket"><a href="#websocket" class="headerlink" title="websocket"></a>websocket</h2><p>双工协议</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="csrf是跨域伪造请求攻击"><a href="#csrf是跨域伪造请求攻击" class="headerlink" title="csrf是跨域伪造请求攻击"></a>csrf是跨域伪造请求攻击</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[lavenderuni@~]<span class="comment"># python run1.py # 开启http://127.0.0.1:8888/</span></span><br><span class="line">[lavenderuni@~]<span class="comment"># python run2.py # 开启http://127.0.0.1:9999/</span></span><br><span class="line"></span><br><span class="line">1. 浏览器打开http://localhost:8888/static/demo1.html</span><br><span class="line">2. 点击跳转到http://127.0.0.1:9999/static/demo2.html</span><br><span class="line">3. 观察demo2.html页面的模拟ajax get请求传到localhost:8888的cookie</span><br><span class="line">4. 观察demo2.html页面的img src请求传到localhost:8888的cookie</span><br><span class="line">5. 点击evil way发起模拟ajax post请求传到localhost:8888的cookie</span><br><span class="line">6. 点击iframe里面的evil way发起form请求传到localhost:8888的cookie</span><br></pre></td></tr></table></figure>

<p>相关测试参照testlab的<a href="https://github.com/listen-lavender/testlab/tree/master/http" target="_blank" rel="noopener">http</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/comet-streaming/">comet streaming</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/csrf/">csrf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/http1-0/">http1.0</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/http1-1/">http1.1</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/http2-0/">http2.0</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/long-polling/">long polling</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/websocket/">websocket</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/theory/">theory</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-scala1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/18/scala1/" class="article-date">
  	<time datetime="2016-08-18T03:09:11.000Z" itemprop="datePublished">2016-08-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/18/scala1/">最佳五本书-scala</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <style>
    img[title="scala"] {width: 20%;}
</style>

<p>scala是一门可以装逼，可以实战的，面向过程和面向对象结合的语言。</p>
<p>想学scala，从5本最值得推荐的书开始<a href="http://yun.baidu.com/share/link?shareid=1187527711&uk=2938948661" target="_blank" rel="noopener">下载</a></p>
<ul>
<li>Programming in Scala: A Comprehensive Step-by-Step Guide, 2nd Edition by Martin Odersky</li>
</ul>
<p><img src="/2016/08/18/scala1/scala1.jpeg" alt="scala"></p>
<p>scala之父Martin Odersky亲自操刀，销量非常好，从从业者的角度介绍编程语言的基本使用、高级特性，可以使你成为一个更优秀高效的开发人员。</p>
<ul>
<li>Scala for the Impatient by Cay S.Horstmann</li>
</ul>
<p><img src="/2016/08/18/scala1/scala2.jpeg" alt="scala"></p>
<p>由Java核心技术作者Cay S.Horstmann撰写，通过简洁实用的代码例子向开发者简要说明Scala能做什么和怎么做，为了有助于快速掌握和运用，将Scala的概念和技术介绍篇章像博客一样渐渐展开。</p>
<ul>
<li>Scala in Depth by Joshua D.Suereth</li>
</ul>
<p><img src="/2016/08/18/scala1/scala3.jpeg" alt="scala"></p>
<p>作者Joshua D.Suereth是Typesafe公司的一名软件工程师，也是scala的代码贡献者之一。<br>本书通过Scala社区出现的最佳实践和设计一个个例子，帮你快速将scala整合到项目开发中，引导你了解这门强大的技术语言。</p>
<ul>
<li>Scala in Action by Nilanjan Raychaudhuri</li>
</ul>
<p><img src="/2016/08/18/scala1/scala4.jpeg" alt="scala"></p>
<p>Nilanjan Raychaudhuri是Scala的优秀实践者之一，本书中通过清晰的逻辑和大量的实例分析，全面介绍了丰富深刻的语言概念和特性，并介绍了日常开发中的编程挑战如何在Scala里面实现。</p>
<ul>
<li>Programming Scala: Scalability = Functional Programming + Objects (Animal Guide) by Dean Wampler and Alex Payne</li>
</ul>
<p><img src="/2016/08/18/scala1/scala5.jpeg" alt="scala"></p>
<p>本书有两位作者，Dean Wampler是编程语言Scala的共同开发者，曾就职于Object Mentor。Alex Payne是Twitter的早期员工之一。书中清楚地解释了Scala作为JVM语言的优势。用代码例子，教你如何将丰富的java类库引入解决企业web项目的实际需求，对Scala的命令行工具、第三方工具和库、IDE插件的使用，提供了有用的帮助。</p>
<p>scala是操控大数据工具spark的最好工具语言。等什么呢？一起学吧。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/FP/">FP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OOP/">OOP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/learning/">learning</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/worthy/">worthy</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/scala/">scala</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-nginx1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/17/nginx1/" class="article-date">
  	<time datetime="2016-08-17T13:31:51.000Z" itemprop="datePublished">2016-08-17</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/17/nginx1/">nginx 指令提取url的参数url的uri</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li><p><a href="http://localhost/test?redirect=https://www.baidu.com/a/b?cd=将军令&amp;e=测试" target="_blank" rel="noopener">http://localhost/test?redirect=https://www.baidu.com/a/b?cd=将军令&amp;e=测试</a></p>
</li>
<li><p><a href="http://localhost/test?redirect=http://www.baidu.com/a/b/c?d=丑小鸭&amp;e=测试" target="_blank" rel="noopener">http://localhost/test?redirect=http://www.baidu.com/a/b/c?d=丑小鸭&amp;e=测试</a></p>
</li>
</ul>
<p>以上两个url的参数redirect都是另一个url，想提取redirect的uri，例如/a/b?cd=将军令，该如何做呢？</p>
<p>以下测试配置可以做到，其中set_unescape_uri的作用是将转码过的url解码，属于<a href="https://github.com/openresty/set-misc-nginx-module" target="_blank" rel="noopener">set-misc-nginx-module</a>；echo是测试打印用的，属于<a href="https://github.com/openresty/echo-nginx-module" target="_blank" rel="noopener">echo-nginx-module</a>。</p>
<p><strong>关键点在于if ( $obj_uri ~ ^(http?://)([^:^/]<em>)(:\d</em>)?(.*)? ) 用正则对字符串做切割，分成4段，当4个参数传入if作用域。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">error_log /usr/<span class="built_in">local</span>/var/<span class="built_in">log</span>/nginx/error.log;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    log_format  main  <span class="string">'$remote_addr - $remote_user [$time_local] "$request" '</span></span><br><span class="line"></span><br><span class="line">    access_log /usr/<span class="built_in">local</span>/var/<span class="built_in">log</span>/nginx/access.log main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">"hello, world!"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location /<span class="built_in">test</span> &#123;</span><br><span class="line">            <span class="built_in">set</span> <span class="variable">$obj_uri</span> <span class="variable">$arg_uri</span>;</span><br><span class="line">            set_unescape_uri <span class="variable">$obj_uri</span>;</span><br><span class="line">            <span class="keyword">if</span> ( <span class="variable">$obj_uri</span> ~ ^(http?://)([^:^/]*)(:\\d*)?(.*)? )&#123;</span><br><span class="line">                <span class="built_in">set</span> <span class="variable">$obj_uri</span> <span class="variable">$4</span>;</span><br><span class="line">                <span class="built_in">echo</span> <span class="variable">$obj_uri</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> ( <span class="variable">$obj_uri</span> ~ ^(https?://)([^:^/]*)(:\\d*)?(.*)? )&#123;</span><br><span class="line">                <span class="built_in">set</span> <span class="variable">$obj_uri</span> <span class="variable">$4</span>;</span><br><span class="line">                <span class="built_in">echo</span> <span class="variable">$obj_uri</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">echo</span> <span class="variable">$obj_uri</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    include servers/*;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/a/b?<span class="built_in">cd</span>=将军令</span><br><span class="line">/a/b/c?d=丑小鸭</span><br></pre></td></tr></table></figure>


      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/extract/">extract</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/regex/">regex</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/urlparameter/">urlparameter</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/转码/">转码</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/backend-tool/">backend-tool</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-pylds" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/16/pylds/" class="article-date">
  	<time datetime="2016-08-16T12:59:42.000Z" itemprop="datePublished">2016-08-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/16/pylds/">c struct of python list and dict</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>python list和dict虽然好用，但是也有坑。</p>
<h2 id="list"><a href="#list" class="headerlink" title="list"></a>list</h2><p>list对象c定义是指针数组：<br>python的list是变长的，并非等同于链表的变长，而是采用指针数组，保证了多种操作的性能平衡，同时支持元素类型的动态性。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    PyObject_VAR_HEAD</span><br><span class="line">    PyObject **ob_item;</span><br><span class="line">    Py_ssize_t allocated;</span><br><span class="line">&#125; PyListObject;</span><br></pre></td></tr></table></figure>

<ul>
<li>PyObject_VAR_HEAD为变长对象头，其中的ob_size表示list长度</li>
<li>ob_item为容器，存储PyObject对象指针</li>
<li>allocated表示已分配多少存储空间</li>
</ul>
<p>list的生命周期：</p>
<ul>
<li>alloc，根据PyListObject free_lists里面的缓存情况和策略，判断是否创建list对象</li>
<li>为ob_item分配内存</li>
<li>append操作，追加元素list.append(obj)，根据ob_item预留空间策略判断是否resize，在ob_item尾部添加指针，指向obj</li>
<li>=操作，更新元素list[i]=obj，就是数组的指针指向新的value对象</li>
<li>insert操作，插入元素list.insert(obj)，根据ob_item预留空间策略判断是否resize，查找插入点，将插入点后的元素向后移，在插入点增加指针，指向obj</li>
<li>remove操作，删除元素list.remove(obj)，查找删除点，删除该位置的指针，将删除点后的元素向前移，根据ob_item预留空间策略判断是否resize</li>
<li>pop操作，弹出元素list.pop(obj)，将尾部指针返回，并删除尾部指针，根据ob_item预留空间策略判断是否resize</li>
<li>回收ob_item的内存</li>
<li>dealloc 根据PyListObject free_lists里面的缓存情况和策略，判断是否销毁list对象</li>
</ul>
<p>list的append、pop性能优于insert、remove，list的slice操作和extends操作都会有resize。</p>
<h2 id="dict"><a href="#dict" class="headerlink" title="dict"></a>dict</h2><p>dict对象c定义是哈希表：<br>哈希表查找的时间复杂度为O(1)，dict采用开放寻址法解决hash冲突，开放寻址法比拉链法能更好地利用CPU cache，cache命中率较高。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    Py_ssize_t me_hash;</span><br><span class="line">    PyObject *me_key;</span><br><span class="line">    PyObject *me_value;</span><br><span class="line">&#125; PyDictEntry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">dictobject</span> <span class="title">PyDictObject</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">dictobject</span> &#123;</span></span><br><span class="line">    PyObject_HEAD</span><br><span class="line">    Py_ssize_t ma_fill; <span class="comment">/* # Active + # Dummy */</span></span><br><span class="line">    Py_ssize_t ma_used; <span class="comment">/* # Active */</span></span><br><span class="line">    Py_ssize_t ma_mask; <span class="comment">/* equal to size of ma_table - 1; calc index*/</span></span><br><span class="line">    PyDictEntry *ma_table;</span><br><span class="line">    PyDictEntry *(*ma_lookup)(PyDictObject *mp, PyObject *key, <span class="keyword">long</span> hash);</span><br><span class="line">    PyDictEntry ma_smalltable[PyDict_MINSIZE];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>entry的Unused：me_key == me_value == NULL，即未使用的空闲状态</li>
<li>entry的Active：me_key != NULL, me_value != NULL，即该entry已被占用</li>
<li>entry的Dummy：me_key == dummy, me_value == NULL</li>
<li>PyObject_HEAD的ob_size用不上，dict没有长度</li>
<li>ma_fill记录Active + Dummy状态的entry数</li>
<li>ma_used记录Active状态的entry数</li>
<li>ma_mask等于slot总数 - 1</li>
<li>ma_table为容器，存储PyDictEntry对象指针</li>
<li>ma_lookup是搜索函数，因为Python中key不一定是String，所有搜索函数针对dict key做优化，当遇到string key使用lookdict_string，否则调用默认的lookdict</li>
<li>ma_smalltable为小字典容器(小于8个key-value)ma_smalltable，超出后再从内存分配空间</li>
</ul>
<p>dict的生命周期：</p>
<ul>
<li>alloc，根据PyDictObject free_lists里面的缓存情况和策略，判断是否创建dict对象，关联搜索方法lookdict_string</li>
<li>为ma_table分配内存</li>
<li>set操作，添加元素dict[key]=val/dict.set(key, val)，将key-val生成PyDictEntry object，检查冲突探测链不存在，计算哈希位置，如果发生冲突，通过二次探测算法，寻找下一个位置，直到找到可用位置，并根据ma_table预留空间策略决定是否resize，添加可用位置的指针，指向PyDictEntry object，并将该位置放入冲突探测链</li>
<li>set操作，更新元素dict[key]=val/dict.set(key, val)，将key-val生成PyDictEntry object，检查冲突探测链存在，找到该位置，将指针指向新的PyDictEntry object</li>
<li>get操作，查找元素dict[key]/dict.get(key)，遍历冲突探测链，找到该位置，返回该位置的指针指向的PyDictEntry object的value</li>
<li>pop操作，弹出元素dict.pop(key)，遍历冲突探测链，找到该位置，返回该位置的指针指向的PyDictEntry object的value，删除对应指针，将PyDictEntry object从Active转换成Dummy，并根据ma_table预留空间策略决定是否resize</li>
<li>popitem，随机删除key-val，性能优于pop操作</li>
<li>del操作，删除元素del dict[key]，遍历冲突探测链，找到该位置，删除对应指针和指向的PyDictEntry object，并根据ma_table预留空间策略决定是否resize</li>
<li>回收ma_table的内存</li>
<li>dealloc 根据PyDictObject free_lists里面的缓存情况和策略，判断是否销毁dict对象</li>
</ul>
<p>tuple、set的解构和list类似，tuple在list基础上加了不可更改限制，只能create，set是在list的基础上加了重复检测方法。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hashtable/">hashtable</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/method/">method</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/performance/">performance</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pointerarray/">pointerarray</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/python/">python</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-redis2" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/16/redis2/" class="article-date">
  	<time datetime="2016-08-16T10:32:13.000Z" itemprop="datePublished">2016-08-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/16/redis2/">redis vs memcached</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>redis和memcached都属于nosql数据库，数据都在内存，都是key-value的数据库，当然，redis能存储复杂的struct类型的value，各种开发语言的客户端都支持的很好。redis和memcached都是极好的缓存工具，什么时候该用redis，什么时候该用memcached呢？<br>意译<a href="http://www.infoworld.com/article/3063161/application-development/why-redis-beats-memcached-for-caching.html" target="_blank" rel="noopener">redis vs memcached</a></p>
<h2 id="Memcached的优势"><a href="#Memcached的优势" class="headerlink" title="Memcached的优势"></a>Memcached的优势</h2><ul>
<li><p>Memcached采用LRU策略淘汰旧数据，适合存放小体积的数据或者静态数据，同样的基本数据在Memcached里面的内存消耗要少，对于动态数据、序列化大体积数据没有什么优势，容易产生内存碎片。</p>
</li>
<li><p>Memcached支持多线程，可以应对性能的压力，一致性hash可以减少数据丢失。redis可以通过集群来抗压，但是部署维护相对复杂。</p>
</li>
</ul>
<h2 id="Redis的优势"><a href="#Redis的优势" class="headerlink" title="Redis的优势"></a>Redis的优势</h2><ul>
<li><p>Redis是单线程的，适合存储各种复杂数据类型，提供了string、list、set、hash、sortedset等数据类型，不会丢数据，可以通过aof或者快照来持久化，甚至可以替代mongo。</p>
</li>
<li><p>Redis的淘汰策略优于Memcached，提供了6中淘汰算法，而且淘汰机制有三层。</p>
<ul>
<li>当读/写一个已经过期的key时，会触发惰性删除策略，直接删除掉这个过期key</li>
<li>惰性删除策略无法保证冷数据被及时删掉，Redis会根据配置文件的hz参数，调用databasesCron()函数触发清理策略，定期主动淘汰一批已过期的key，每次淘汰任务执行的最大时长timelimit根据hz参数计算而来，和hz是倒数关系，主动淘汰频率越高，则每次淘汰最长占用时间就越短，避免每次主动淘汰阻塞应用请求</li>
<li>当前已用内存超过maxmemory限定时，根据用户配置的maxmemory-policy参数(一般为LRU/TTL)，选取算法对redis里面的maxmemory-samples个key进行抽样清理(maxmemory-samples的增加，会提高LRU或TTL的精准度，同时会导致清理时消耗更多的CPU时间；最好不要触发这个清理)</li>
</ul>
</li>
<li><p>Redis的key长度是512MB，Memcached限制key长度在250 bytes以内。</p>
</li>
<li><p>Redis可以搭载lua脚本。</p>
</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cache-algorithm/">cache algorithm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nosql/">nosql</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/threading/">threading</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/backend-tool/">backend-tool</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2020 listen
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
    <script type="text/javascript">
      (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
      (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
      e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
      })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
      
      _st('install','hPJFSMYvMX8XnCRm-L2e','2.0.0');
    </script>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>